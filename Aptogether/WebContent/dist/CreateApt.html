<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no" />
<meta name="description" content="" />
<meta name="author" content="" />
<title>Aptogether</title>
<link href="css/styles.css" rel="stylesheet" />
<link href="css/createApt.css" rel="stylesheet" />
<link
	href="https://cdn.datatables.net/1.10.20/css/dataTables.bootstrap4.min.css"
	rel="stylesheet" crossorigin="anonymous" />
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/js/all.min.js"
	crossorigin="anonymous"></script>
</head>
<body class="sb-nav-fixed">
	<nav class="sb-topnav navbar navbar-expand navbar-dark bg-dark">
		<a class="navbar-brand" href="index.html">AparTogether</a>
		<button class="btn btn-link btn-sm order-1 order-lg-0"
			id="sidebarToggle" href="#">
			<i class="fas fa-bars"></i>
		</button>
		<!-- Navbar Search-->
		<form
			class="d-none d-md-inline-block form-inline ml-auto mr-0 mr-md-3 my-2 my-md-0">
			<div class="input-group">
				<input class="form-control" type="text" placeholder="Search for..."
					aria-label="Search" aria-describedby="basic-addon2" />
				<div class="input-group-append">
					<button class="btn btn-primary" type="button">
						<i class="fas fa-search"></i>
					</button>
				</div>
			</div>
		</form>
		<!-- Navbar-->
		<ul class="navbar-nav ml-auto ml-md-0">
			<li class="nav-item dropdown"><a
				class="nav-link dropdown-toggle" id="userDropdown" href="#"
				role="button" data-toggle="dropdown" aria-haspopup="true"
				aria-expanded="false"><i class="fas fa-user fa-fw"></i></a>
				<div class="dropdown-menu dropdown-menu-right"
					aria-labelledby="userDropdown">
					<a class="dropdown-item" href="#">Settings</a><a
						class="dropdown-item" href="#">Activity Log</a>
					<div class="dropdown-divider"></div>
					<a class="dropdown-item" href="login.html">Logout</a>
				</div></li>
		</ul>
	</nav>
	<div id="layoutSidenav">
		<div id="layoutSidenav_nav">
			<nav class="sb-sidenav accordion sb-sidenav-dark"
				id="sidenavAccordion">
				<div class="sb-sidenav-menu">
					<div class="nav">
						<div class="sb-sidenav-menu-heading">Core</div>
						<a class="nav-link" href="index.html"><div
								class="sb-nav-link-icon">
								<i class="fas fa-tachometer-alt"></i>
							</div> Dashboard</a>
						<div class="sb-sidenav-menu-heading">Interface</div>
						<a class="nav-link collapsed" href="#" data-toggle="collapse"
							data-target="#collapseLayouts" aria-expanded="false"
							aria-controls="collapseLayouts"><div class="sb-nav-link-icon">
								<i class="fas fa-columns"></i>
							</div> Layouts
							<div class="sb-sidenav-collapse-arrow">
								<i class="fas fa-angle-down"></i>
							</div></a>
						<div class="collapse" id="collapseLayouts"
							aria-labelledby="headingOne" data-parent="#sidenavAccordion">
							<nav class="sb-sidenav-menu-nested nav">
								<a class="nav-link" href="layout-static.html">Static
									Navigation</a><a class="nav-link" href="layout-sidenav-light.html">Light
									Sidenav</a>
							</nav>
						</div>
						<a class="nav-link collapsed" href="#" data-toggle="collapse"
							data-target="#collapsePages" aria-expanded="false"
							aria-controls="collapsePages"><div class="sb-nav-link-icon">
								<i class="fas fa-book-open"></i>
							</div> Pages
							<div class="sb-sidenav-collapse-arrow">
								<i class="fas fa-angle-down"></i>
							</div></a>
						<div class="collapse" id="collapsePages"
							aria-labelledby="headingTwo" data-parent="#sidenavAccordion">
							<nav class="sb-sidenav-menu-nested nav accordion"
								id="sidenavAccordionPages">
								<a class="nav-link collapsed" href="#" data-toggle="collapse"
									data-target="#pagesCollapseAuth" aria-expanded="false"
									aria-controls="pagesCollapseAuth">Authentication
									<div class="sb-sidenav-collapse-arrow">
										<i class="fas fa-angle-down"></i>
									</div>
								</a>
								<div class="collapse" id="pagesCollapseAuth"
									aria-labelledby="headingOne"
									data-parent="#sidenavAccordionPages">
									<nav class="sb-sidenav-menu-nested nav">
										<a class="nav-link" href="login.html">Login</a><a
											class="nav-link" href="register.html">Register</a><a
											class="nav-link" href="password.html">Forgot Password</a>
									</nav>
								</div>
								<a class="nav-link collapsed" href="#" data-toggle="collapse"
									data-target="#pagesCollapseError" aria-expanded="false"
									aria-controls="pagesCollapseError">Error
									<div class="sb-sidenav-collapse-arrow">
										<i class="fas fa-angle-down"></i>
									</div>
								</a>
								<div class="collapse" id="pagesCollapseError"
									aria-labelledby="headingOne"
									data-parent="#sidenavAccordionPages">
									<nav class="sb-sidenav-menu-nested nav">
										<a class="nav-link" href="401.html">401 Page</a><a
											class="nav-link" href="404.html">404 Page</a><a
											class="nav-link" href="500.html">500 Page</a>
									</nav>
								</div>
							</nav>
						</div>
						<div class="sb-sidenav-menu-heading">Addons</div>
						<a class="nav-link" href="charts.html"><div
								class="sb-nav-link-icon">
								<i class="fas fa-chart-area"></i>
							</div> Charts</a><a class="nav-link" href="tables.html"><div
								class="sb-nav-link-icon">
								<i class="fas fa-table"></i>
							</div> Tables</a>
					</div>
				</div>
				<div class="sb-sidenav-footer">
					<div class="small">Logged in as:</div>
					Start Bootstrap
				</div>
			</nav>
		</div>
		<div id="layoutSidenav_content">
			<main>
			<div class="container-fluid">
				<h1 class="mt-4">반갑습니다 아파트 등록 페이지입니다.</h1>
				<ol class="breadcrumb mb-4">
					<li class="breadcrumb-item active">Dashboard</li>
				</ol>
				<div class="row">
					<div class="col-xl-3 col-md-6">
						<div class="card bg-primary text-white mb-4">
							<div class="card-body">Primary Card</div>
							<div
								class="card-footer d-flex align-items-center justify-content-between">
								<a class="small text-white stretched-link" href="#">View
									Details</a>
								<div class="small text-white">
									<i class="fas fa-angle-right"></i>
								</div>
							</div>
						</div>
					</div>
					<div class="col-xl-3 col-md-6">
						<div class="card bg-warning text-white mb-4">
							<div class="card-body">Warning Card</div>
							<div
								class="card-footer d-flex align-items-center justify-content-between">
								<a class="small text-white stretched-link" href="#">View
									Details</a>
								<div class="small text-white">
									<i class="fas fa-angle-right"></i>
								</div>
							</div>
						</div>
					</div>
					<div class="col-xl-3 col-md-6">
						<div class="card bg-success text-white mb-4">
							<div class="card-body">Success Card</div>
							<div
								class="card-footer d-flex align-items-center justify-content-between">
								<a class="small text-white stretched-link" href="#">View
									Details</a>
								<div class="small text-white">
									<i class="fas fa-angle-right"></i>
								</div>
							</div>
						</div>
					</div>
					<div class="col-xl-3 col-md-6">
						<div class="card bg-danger text-white mb-4">
							<div class="card-body">Danger Card</div>
							<div
								class="card-footer d-flex align-items-center justify-content-between">
								<a class="small text-white stretched-link" href="#">View
									Details</a>
								<div class="small text-white">
									<i class="fas fa-angle-right"></i>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-xl-6">
						<div class="card mb-4">
							<div class="card-header">
								<i class="fas fa-chart-area mr-1"></i>아파트 등록
							</div>
							<div>
								<input type="text" id="sample3_postcode" placeholder="우편번호">
								<input type="button" onclick="sample3_execDaumPostcode()"
									value="우편번호 찾기"><br> <input type="text"
									id="sample3_address" placeholder="주소"><br> <input
									type="text" id="sample3_detailAddress" placeholder="상세주소">
								<input type="text" id="sample3_extraAddress" placeholder="참고항목">

								<div id="wrap"
									style="display: none; border: 1px solid; width: 500px; height: 300px; margin: 5px 0; position: relative">
									<img src="//t1.daumcdn.net/postcode/resource/images/close.png"
										id="btnFoldWrap"
										style="cursor: pointer; position: absolute; right: 0px; top: -1px; z-index: 1"
										onclick="foldDaumPostcode()" alt="접기 버튼">
								</div>
							</div>
						</div>
					</div>
					<div class="col-xl-6">
						<div class="card mb-4">
							<div class="card-header">
								<i class="fas fa-chart-bar mr-1"></i>법정동 코드를 기준으로 검색한 아파트 목록
							</div>
							<div class="apt-list"></div>

						</div>
					</div>

					<div class="modal">
						<div class="modal-content col-xl-6">
							<div class="apt-name"></div>
							<div class="apt-address"></div>
							<div class="apt-lat"></div>
							<div class="apt-long"></div>
							<input type="button" onclick="doAction()" value="저장하기 " /> 
							<input type="button"
								onclick="closeModal()" value="닫기 ">
						</div>
					</div>
				</div>



				<script src="https://code.jquery.com/jquery-3.4.1.min.js"
					crossorigin="anonymous"></script>
				<script type="text/javascript">
					let bjdCode = "";
					let aptName = "";
					let kaptCode = "";
					let x = "";
					let y = "";
					let aptLocation = "";
 					function doAction() {
						 $.ajax({
							url: "/Aptogether/apt/insertAptInfo",
							type: "GET",
							dataType: "text",
							data: {
								"kaptCode": kaptCode,
								"aptName": aptName,
								"location": aptLocation,
								"x": x,
								"y": y
							},
							success: function(data){
								if(data == "success"){
									alert("입력에 성공하셨습니다.");
								}else {
									alert("잠시후 다시 시도해주세요.");
								}
							},
							error: function(request, status, error) {
								alert("요청에 실패하였습니다. 조금 있다 다시 요청해주세요.")
							}
						}) 
					} 
					function apt_select_click(aptCode) {
						aptName = "";
						kaptCode = "";
						x = "";
						y = "";
						aptLocation = "";
						$('.modal').toggle();
						$.ajax({
							url : "/Aptogether/apt/aptDetail",
							type : "GET",
							dataType : "text",
							data : {
								"kaptCode" : aptCode
							},
							success : function(data) {
								console.log(data);
								let json = JSON.parse(data);
								kaptCode = aptCode;
								aptName = json.aptDetailInfo[0].kaptName;
								aptLocation = json.aptDetailInfo[0].kaptAddr;
								
								$('.apt-name').html(json.aptDetailInfo[0].kaptName);
								$('.apt-address').html(json.aptDetailInfo[0].kaptAddr);	
								$.ajax({
									url: '/Aptogether/apt/getLocation',
									type: "GET",
									dataType: "text",
									data: {
										"location": json.aptDetailInfo[0].doroJuso
									},
									success: function(data) {
										console.log(data);
										let locationJson = JSON.parse(data);
										$('.apt-long').html(locationJson.documents[0].x);
										$('.apt-lat').html(locationJson.documents[0].y);
										x = locationJson.documents[0].x;
										y = locationJson.documents[0].y;
									},
									error: function(data) {
										$('.apt-long').html("좌표정보 획득에 실패하였습니다.");
									}
								})
							},
							error:function(request,status, error) {
								console.log(error);
								console.log(status);
								console.log("error");
							}
						});
					}
					function closeModal() {
						$('.modal').toggle();
					}
				</script>
				<script
					src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.bundle.min.js"
					crossorigin="anonymous"></script>
				<script src="js/scripts.js"></script>
				<script
					src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js"
					crossorigin="anonymous"></script>
				<script src="assets/demo/chart-area-demo.js"></script>
				<script src="assets/demo/chart-bar-demo.js"></script>
				<script
					src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"
					crossorigin="anonymous"></script>
				<script
					src="https://cdn.datatables.net/1.10.20/js/dataTables.bootstrap4.min.js"
					crossorigin="anonymous"></script>
				<script src="assets/demo/datatables-demo.js"></script>
				<script
					src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
				<script>
					// 우편번호 찾기 찾기 화면을 넣을 element
					var element_wrap = document.getElementById('wrap');

					function foldDaumPostcode() {
						// iframe을 넣은 element를 안보이게 한다.
						element_wrap.style.display = 'none';
					}

					function sample3_execDaumPostcode() {
						// 현재 scroll 위치를 저장해놓는다.
						var currentScroll = Math.max(document.body.scrollTop,
								document.documentElement.scrollTop);
						new daum.Postcode(
								{
									oncomplete : function(data) {
										// 검색결과 항목을 클릭했을때 실행할 코드를 작성하는 부분.

										// 각 주소의 노출 규칙에 따라 주소를 조합한다.
										// 내려오는 변수가 값이 없는 경우엔 공백('')값을 가지므로, 이를 참고하여 분기 한다.
										var addr = ''; // 주소 변수
										var extraAddr = ''; // 참고항목 변수
										console.log(data.bcode, data.bname,
												data.bname1, data.bname2);
										bjdCode = data.bcode;
										console.log(bjdCode);
										$
												.ajax({
													url : "/Aptogether/apt/aptList",
													type : "GET",
													dataType : "text",
													data : {
														"bjdCode" : bjdCode
													},
													success : function(bjd) {
														console.log(bjd);
														let json = JSON
																.parse(bjd);
														$('.apt-list').html("");
														for ( var prop in json.aptInfo) {
															console
																	.log(json.aptInfo[prop]);
															$('.apt-list')
																	.append(
																			'<div class="apt-list-detail">'
																					+ json.aptInfo[prop].kaptName
																					+ '('
																					+ json.aptInfo[prop].kaptCode
																					+ ')'
																					+ '<input type="button" id="button1" onclick="apt_select_click('
																					+ "'"
																					+ json.aptInfo[prop].kaptCode
																					+ "'"
																					+ ')" value="선택" />'
																					+ '<div>')
														}

													},

													error : function(request,
															status, error) {
														console.log(error);
														console.log(status);
														console.log("error");
													}

												});

										//사용자가 선택한 주소 타입에 따라 해당 주소 값을 가져온다.
										if (data.userSelectedType === 'R') { // 사용자가 도로명 주소를 선택했을 경우
											addr = data.roadAddress;
										} else { // 사용자가 지번 주소를 선택했을 경우(J)
											addr = data.jibunAddress;
										}

										// 사용자가 선택한 주소가 도로명 타입일때 참고항목을 조합한다.
										if (data.userSelectedType === 'R') {
											// 법정동명이 있을 경우 추가한다. (법정리는 제외)
											// 법정동의 경우 마지막 문자가 "동/로/가"로 끝난다.
											if (data.bname !== ''
													&& /[동|로|가]$/g
															.test(data.bname)) {
												extraAddr += data.bname;
											}
											// 건물명이 있고, 공동주택일 경우 추가한다.
											if (data.buildingName !== ''
													&& data.apartment === 'Y') {
												extraAddr += (extraAddr !== '' ? ', '
														+ data.buildingName
														: data.buildingName);
											}
											// 표시할 참고항목이 있을 경우, 괄호까지 추가한 최종 문자열을 만든다.
											if (extraAddr !== '') {
												extraAddr = ' (' + extraAddr
														+ ')';
											}
											// 조합된 참고항목을 해당 필드에 넣는다.
											document
													.getElementById("sample3_extraAddress").value = extraAddr;

										} else {
											document
													.getElementById("sample3_extraAddress").value = '';
										}

										// 우편번호와 주소 정보를 해당 필드에 넣는다.
										document
												.getElementById('sample3_postcode').value = data.zonecode;
										document
												.getElementById("sample3_address").value = addr;
										// 커서를 상세주소 필드로 이동한다.
										document.getElementById(
												"sample3_detailAddress")
												.focus();

										// iframe을 넣은 element를 안보이게 한다.
										// (autoClose:false 기능을 이용한다면, 아래 코드를 제거해야 화면에서 사라지지 않는다.)
										element_wrap.style.display = 'none';

										// 우편번호 찾기 화면이 보이기 이전으로 scroll 위치를 되돌린다.
										document.body.scrollTop = currentScroll;
									},
									// 우편번호 찾기 화면 크기가 조정되었을때 실행할 코드를 작성하는 부분. iframe을 넣은 element의 높이값을 조정한다.
									onresize : function(size) {
										element_wrap.style.height = size.height
												+ 'px';
									},
									width : '100%',
									height : '100%'
								}).embed(element_wrap);

						// iframe을 넣은 element를 보이게 한다.
						element_wrap.style.display = 'block';
					}
				</script>
</body>
</html>
