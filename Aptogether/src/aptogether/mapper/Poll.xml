<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">



<mapper namespace="aptogether.mapper.PollMapper">
	<cache />

	<insert id="PollInsert" parameterType="Poll">
		insert into poll
		values(poll_seq.nextval,#{question},sysdate,to_date(sysdate+7),0,#{contents},#{apt_seq})
	</insert>

	<!-- <insert id="PollOption" parameterType="Option"> insert into poll_options 
		values(poll_option_seq.nextval,#{option},poll_seq.currval) </insert> -->

	<insert id="PollOption" parameterType="java.util.List">
		insert into poll_options(option_seq, option_text, poll_seq) select
		poll_option_seq.nextval, A.* , poll_seq.currval From(
		<foreach collection="list" item="item" index="index"
			separator="UNION ALL ">
			select #{item.option_text} From dual
		</foreach>
		) A
	</insert>


	<select id="PollList" resultType="Poll" parameterType="Member">
		select *
		from poll where apt_seq = #{apt_seq} order by poll_seq
	</select>

	<select id="OptionList" resultType="Option" parameterType="int">
		select * from poll_options where poll_seq = #{seq}
	</select>

	<select id="PollSelectInsert" parameterType="PollSelect">

		<if test='member_seq != "1"'>
			insert into poll_select
			values(poll_select_seq.nextval,1,sysdate,#{option_seq})
		</if>
	</select>

	<select id="PollDetailList" resultType="Detail"
		parameterType="int">
		select *
		from poll_select ps left join member mb
		on mb.member_seq = ps.member_seq
		left join poll_options po
		on po.OPTION_SEQ = ps.OPTION_SEQ
		left join poll p
		on p.POLL_SEQ = po.POLL_SEQ
		where p.poll_seq = #{seq}
	</select>

	<update id="PollHitCount" parameterType="int">
		update poll set hitcount
		= hitcount+1 where poll_seq = #{seq}
	</update>

</mapper>